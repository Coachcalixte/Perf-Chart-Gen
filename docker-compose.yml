# Docker Compose configuration for local testing
# Usage: docker-compose up -d
# Access app at: http://localhost:8501

version: '3.8'

services:
  streamlit-app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: perf-chart-gen
    ports:
      - "8501:8501"
    environment:
      # Environment variables for flexible configuration
      - STREAMLIT_SERVER_PORT=8501
      - STREAMLIT_SERVER_ADDRESS=0.0.0.0
      - STREAMLIT_SERVER_HEADLESS=true

      # Allowed origins for CORS (WordPress domains that can iframe this app)
      # Modify this list as needed for different environments
      - ALLOWED_ORIGINS=http://refsc.local,http://localhost,https://wordpress.hanstack.win,https://tools-backend.hanstack.win

    volumes:
      # Mount local directory for development (optional)
      # Uncomment to enable hot-reload during development
      # - ./athlete_report_streamlit.py:/app/athlete_report_streamlit.py
      # - ./athlete_report.py:/app/athlete_report.py
      # - ./team_report_generator.py:/app/team_report_generator.py

      # Mount volume for generated reports
      - reports-data:/app/reports

    restart: unless-stopped

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8501/_stcore/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

    networks:
      - app-network

volumes:
  reports-data:
    driver: local

networks:
  app-network:
    driver: bridge

# Additional services can be added here (e.g., nginx reverse proxy)
